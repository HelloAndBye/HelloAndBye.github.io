<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel在线预览与下载</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome图标 -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- 引入SheetJS库（处理Excel文件） -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <!-- Tailwind配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#10b981',
            neutral: '#f1f5f9',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .table-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .upload-hover {
        @apply transition-all duration-300 hover:border-primary hover:bg-blue-50;
      }
      .btn-effect {
        @apply transform transition-all duration-300 hover:scale-105 active:scale-95;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-file-excel-o text-primary text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold text-gray-800">Excel在线共享平台</h1>
      </div>
      <div class="hidden md:flex items-center space-x-6">
        <a href="#" class="text-gray-600 hover:text-primary transition-colors">首页</a>
        <a href="#" class="text-gray-600 hover:text-primary transition-colors">帮助</a>
        <a href="#" class="text-gray-600 hover:text-primary transition-colors">关于</a>
      </div>
      <button class="md:hidden text-gray-600">
        <i class="fa fa-bars text-xl"></i>
      </button>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="container mx-auto px-4 py-8">
    <!-- 上传区域 -->
    <section class="max-w-3xl mx-auto mb-12">
      <div class="bg-white rounded-xl p-6 md:p-8 table-shadow">
        <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 flex items-center">
          <i class="fa fa-upload text-primary mr-3"></i>上传Excel文件
        </h2>
        
        <!-- 上传按钮 -->
        <label for="file-upload" class="block w-full border-2 border-dashed border-gray-300 rounded-lg p-8 text-center upload-hover cursor-pointer">
          <input id="file-upload" type="file" accept=".xlsx,.xls" class="hidden" />
          <div class="space-y-2">
            <i class="fa fa-file-excel-o text-4xl text-primary"></i>
            <p class="text-gray-600">点击或拖拽Excel文件到此处上传</p>
            <p class="text-sm text-gray-400">支持 .xlsx 和 .xls 格式文件</p>
          </div>
        </label>
        
        <!-- 文件信息 -->
        <div id="file-info" class="mt-6 hidden">
          <div class="flex items-center justify-between p-4 bg-neutral rounded-lg">
            <div class="flex items-center">
              <i class="fa fa-file-excel-o text-primary mr-3 text-xl"></i>
              <div>
                <p id="file-name" class="font-medium text-gray-800 truncate max-w-xs"></p>
                <p id="file-size" class="text-sm text-gray-500"></p>
              </div>
            </div>
            <button id="remove-file" class="text-red-500 hover:text-red-700 transition-colors">
              <i class="fa fa-times-circle text-xl"></i>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- 表格预览区域 -->
    <section id="table-preview" class="max-w-6xl mx-auto hidden">
      <div class="bg-white rounded-xl p-6 md:p-8 table-shadow">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6">
          <h2 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center mb-4 md:mb-0">
            <i class="fa fa-table text-primary mr-3"></i>表格预览
          </h2>
          
          <!-- 下载按钮组 -->
          <div class="flex space-x-3">
            <button id="download-original" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg flex items-center btn-effect">
              <i class="fa fa-download mr-2"></i>下载原文件
            </button>
            <button id="download-csv" class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg flex items-center btn-effect">
              <i class="fa fa-file-text-o mr-2"></i>导出CSV
            </button>
          </div>
        </div>
        
        <!-- 表格容器（带滚动） -->
        <div class="overflow-x-auto">
          <table id="excel-table" class="w-full border-collapse">
            <thead>
              <tr id="table-header" class="bg-primary/10"></tr>
            </thead>
            <tbody id="table-body"></tbody>
          </table>
        </div>
        
        <!-- 分页控制（如果表格数据较多） -->
        <div id="pagination" class="mt-6 flex justify-center hidden">
          <nav class="flex items-center space-x-1">
            <button class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">
              <i class="fa fa-chevron-left text-sm"></i>
            </button>
            <button class="px-3 py-1 rounded border border-primary bg-primary text-white">1</button>
            <button class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">2</button>
            <button class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">3</button>
            <button class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">
              <i class="fa fa-chevron-right text-sm"></i>
            </button>
          </nav>
        </div>
      </div>
    </section>

    <!-- 空状态提示 -->
    <section id="empty-state" class="max-w-3xl mx-auto text-center py-16">
      <div class="bg-white rounded-xl p-8 table-shadow">
        <i class="fa fa-file-excel-o text-gray-300 text-6xl mb-4"></i>
        <h3 class="text-xl font-bold text-gray-700 mb-2">暂无Excel文件</h3>
        <p class="text-gray-500 mb-6">上传一个Excel文件，即可在这里预览并分享给他人下载</p>
        <button id="empty-upload-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg flex items-center mx-auto btn-effect">
          <i class="fa fa-upload mr-2"></i>上传文件
        </button>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-gray-800 text-white py-8 mt-16">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="flex items-center mb-4 md:mb-0">
          <i class="fa fa-file-excel-o text-primary text-2xl mr-2"></i>
          <span class="text-xl font-bold">Excel在线共享平台</span>
        </div>
        <div class="flex space-x-6 mb-4 md:mb-0">
          <a href="#" class="hover:text-primary transition-colors"><i class="fa fa-github text-xl"></i></a>
          <a href="#" class="hover:text-primary transition-colors"><i class="fa fa-twitter text-xl"></i></a>
          <a href="#" class="hover:text-primary transition-colors"><i class="fa fa-linkedin text-xl"></i></a>
        </div>
        <p class="text-gray-400 text-sm">© 2025 Excel在线共享平台. 保留所有权利.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript逻辑 -->
  <script>
    // 全局变量
    let excelFile = null;
    let excelData = null;
    
    // DOM元素
    const fileUpload = document.getElementById('file-upload');
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const removeFile = document.getElementById('remove-file');
    const tablePreview = document.getElementById('table-preview');
    const emptyState = document.getElementById('empty-state');
    const excelTable = document.getElementById('excel-table');
    const tableHeader = document.getElementById('table-header');
    const tableBody = document.getElementById('table-body');
    const downloadOriginal = document.getElementById('download-original');
    const downloadCsv = document.getElementById('download-csv');
    const emptyUploadBtn = document.getElementById('empty-upload-btn');
    
    // 事件监听 - 上传文件
    fileUpload.addEventListener('change', handleFileUpload);
    
    // 事件监听 - 移除文件
    removeFile.addEventListener('click', clearFile);
    
    // 事件监听 - 空状态上传按钮
    emptyUploadBtn.addEventListener('click', () => fileUpload.click());
    
    // 事件监听 - 下载原文件
    downloadOriginal.addEventListener('click', downloadOriginalFile);
    
    // 事件监听 - 导出CSV
    downloadCsv.addEventListener('click', exportToCsv);
    
    // 处理文件上传
    function handleFileUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      // 验证文件类型
      const fileTypes = [
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'application/vnd.ms-excel'
      ];
      
      if (!fileTypes.includes(file.type) && 
          !file.name.endsWith('.xlsx') && 
          !file.name.endsWith('.xls')) {
        alert('请上传有效的Excel文件（.xlsx 或 .xls 格式）');
        return;
      }
      
      excelFile = file;
      
      // 显示文件信息
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      fileInfo.classList.remove('hidden');
      emptyState.classList.add('hidden');
      tablePreview.classList.remove('hidden');
      
      // 解析Excel文件
      parseExcelFile(file);
    }
    
    // 解析Excel文件
    function parseExcelFile(file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        
        // 获取第一个工作表
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        
        // 转换为JSON格式
        excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
        
        // 渲染表格
        renderTable(excelData);
      };
      
      reader.onerror = function() {
        alert('文件读取失败，请重试');
      };
      
      reader.readAsArrayBuffer(file);
    }
    
    // 渲染表格
    function renderTable(data) {
      if (!data || data.length === 0) return;
      
      // 清空表格
      tableHeader.innerHTML = '';
      tableBody.innerHTML = '';
      
      // 创建表头
      const headers = data[0];
      headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header || '';
        th.className = 'px-4 py-3 text-left text-gray-700 font-semibold border-b border-gray-200';
        tableHeader.appendChild(th);
      });
      
      // 创建表格内容
      for (let i = 1; i < data.length; i++) {
        const row = data[i];
        const tr = document.createElement('tr');
        tr.className = i % 2 === 0 ? 'bg-white' : 'bg-gray-50';
        tr.classList.add('hover:bg-gray-100', 'transition-colors');
        
        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell || '';
          td.className = 'px-4 py-3 border-b border-gray-200 text-gray-700';
          tr.appendChild(td);
        });
        
        tableBody.appendChild(tr);
      }
      
      // 如果数据较多，显示分页
      if (data.length > 10) {
        document.getElementById('pagination').classList.remove('hidden');
      }
    }
    
    // 清除文件
    function clearFile() {
      excelFile = null;
      excelData = null;
      fileUpload.value = '';
      fileInfo.classList.add('hidden');
      tablePreview.classList.add('hidden');
      emptyState.classList.remove('hidden');
    }
    
    // 下载原文件
    function downloadOriginalFile() {
      if (!excelFile) return;
      
      const url = URL.createObjectURL(excelFile);
      const a = document.createElement('a');
      a.href = url;
      a.download = excelFile.name;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    
    // 导出为CSV
    function exportToCsv() {
      if (!excelData) return;
      
      // 转换为CSV字符串
      let csvContent = '';
      excelData.forEach(row => {
        const rowString = row.map(cell => {
          // 处理包含逗号或引号的单元格
          if (cell && (cell.toString().includes(',') || cell.toString().includes('"'))) {
            return `"${cell.toString().replace(/"/g, '""')}"`;
          }
          return cell || '';
        }).join(',');
        csvContent += rowString + '\n';
      });
      
      // 创建下载链接
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      
      // 文件名（替换原扩展名）
      const csvFileName = excelFile ? 
        excelFile.name.replace(/\.(xlsx|xls)$/, '.csv') : 
        'export.csv';
      
      a.href = url;
      a.download = csvFileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    
    // 格式化文件大小
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>
